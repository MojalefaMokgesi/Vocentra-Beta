@model Vocentra.Models.Applicant
@{
    ViewData["Title"] = "Apply for " + (ViewBag.JobTitle ?? "Job");
    // When the POST fails validation and returns the view, the controller can set ViewBag.StartStep
    var startStep = ViewBag.StartStep ?? 1;
}

<style>
    body {
        background-color: #f7f7f7;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        color: #111;
    }

    .apply-container {
        width: 100%;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        padding: 4rem 1rem;
    }

    form.apply-form {
        width: 100%;
        max-width: 750px;
        background: #fff;
        border-radius: 1rem;
        padding: 3rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
    }

        form.apply-form h2 {
            text-align: center;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 2rem;
        }

    .progress-dots {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-bottom: 2rem;
    }

        .progress-dots span {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #d1d5db;
            transition: background 0.3s ease;
        }

        .progress-dots .active {
            background: #1f2937;
        }

    .step {
        display: none;
        flex-direction: column;
        gap: 2rem;
    }

        .step.active {
            display: flex;
        }

    label {
        font-weight: 600;
        margin-bottom: 0.5rem;
        display: block;
        color: #1f2937;
    }

    input, select, textarea {
        width: 100%;
        max-width: 300px;
        padding: 0.75rem 1rem;
        border: 1px solid #d1d5db;
        border-radius: 0.5rem;
        font-size: 1rem;
        outline: none;
        transition: border-color 0.3s ease, box-shadow 0.2s ease;
        margin-bottom: 0.5rem;
    }

        input:focus, select:focus, textarea:focus {
            border-color: #1f2937;
            box-shadow: 0 0 5px rgba(0,0,0,0.1);
        }

    .button-group {
        display: flex;
        justify-content: space-between;
        gap: 1rem;
        margin-top: 1.5rem;
    }

        .button-group button {
            flex: 1;
            padding: 0.75rem 1rem;
            font-weight: 600;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

    .btn-back {
        background-color: #e5e7eb;
        color: #111;
    }

        .btn-back:hover {
            background-color: #d1d5db;
        }

    .btn-next {
        background-color: #1f2937;
        color: #fff;
    }

        .btn-next:hover {
            background-color: #111827;
        }

    .btn-submit {
        background-color: #2563eb;
        color: #fff;
    }

        .btn-submit:hover {
            background-color: #1d4ed8;
        }

    p.step-instructions {
        text-align: center;
        color: #4b5563;
        font-size: 1rem;
    }

    .grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1.5rem 2rem;
    }

    @@media (min-width: 768px) {
        .grid {
            grid-template-columns: repeat(2, minmax(200px, 1fr));
            gap: 1.5rem 2rem;
        }
    }

    .col-span-2 {
        grid-column: span 2;
    }
</style>

<div class="apply-container">
    <form asp-action="Apply" asp-controller="Job" method="post" enctype="multipart/form-data" class="apply-form">
        @Html.AntiForgeryToken()
        <input type="hidden" asp-for="JobId" />

        <!-- remembers the last step so if validation fails we can show the right step -->
        <input type="hidden" id="CurrentStep" name="CurrentStep" value="@startStep" />

        <h2>@ViewData["Title"]</h2>

        @Html.ValidationSummary(true, "", new { @class = "text-danger mb-3" })

        <div class="progress-dots">
            <span id="dot1" class="active"></span>
            <span id="dot2"></span>
            <span id="dot3"></span>
        </div>

        <!-- STEP 1: Personal Info -->
        <div id="step1" class="step active">
            <p class="step-instructions">👋 Let’s get started! Enter your personal and contact information.</p>
            <div class="grid">
                <div><label asp-for="Title"></label><input asp-for="Title" /></div>
                <div><label asp-for="Initials"></label><input asp-for="Initials" /></div>
                <div><label asp-for="FirstName"></label><input asp-for="FirstName" required /></div>
                <div><label asp-for="MiddleName"></label><input asp-for="MiddleName" /></div>
                <div><label asp-for="Surname"></label><input asp-for="Surname" required /></div>
                <div><label asp-for="KnownAs"></label><input asp-for="KnownAs" /></div>
                <div><label asp-for="IdNumber"></label><input asp-for="IdNumber" required /></div>
                <div><label asp-for="Nationality"></label><input asp-for="Nationality" /></div>
                <div><label asp-for="DateOfBirth"></label><input asp-for="DateOfBirth" type="date" /></div>
                <div><label asp-for="HomeLanguage"></label><input asp-for="HomeLanguage" /></div>
                <div><label asp-for="Email"></label><input asp-for="Email" type="email" required /></div>
                <div><label asp-for="Telephone"></label><input asp-for="Telephone" /></div>
                <div><label asp-for="Gender"></label><input asp-for="Gender" /></div>
                <div><label asp-for="Ethnicity"></label><input asp-for="Ethnicity" /></div>
                <div><label asp-for="Disability"></label><input asp-for="Disability" /></div>
                <div><label asp-for="HighestQualification"></label><input asp-for="HighestQualification" /></div>
                <div><label asp-for="CurrentCTC"></label><input asp-for="CurrentCTC" /></div>
                <div><label asp-for="ExpectedCTC"></label><input asp-for="ExpectedCTC" /></div>
                <div class="col-span-2"><label asp-for="CurrentLocation"></label><input asp-for="CurrentLocation" /></div>
            </div>
            <div class="button-group">
                <button type="button" class="btn-next" onclick="goToStep(2)">Next</button>
            </div>
        </div>

        <!-- STEP 2: Professional Links -->
        <div id="step2" class="step">
            <p class="step-instructions">💼 Add professional links (optional)</p>
            <div class="grid">
                <div><label asp-for="LinkedInProfile"></label><input asp-for="LinkedInProfile" /></div>
                <div><label asp-for="PortfolioWebsite"></label><input asp-for="PortfolioWebsite" /></div>
                <!-- ResumeLink is OPTIONAL in your model, so don't force it required in HTML -->
                <div class="col-span-2"><label asp-for="ResumeLink"></label><input asp-for="ResumeLink" /></div>
            </div>
            <div class="button-group">
                <button type="button" class="btn-back" onclick="goToStep(1)">Back</button>
                <button type="button" class="btn-next" onclick="goToStep(3)">Next</button>
            </div>
        </div>

        <!-- STEP 3: File Uploads -->
        <div id="step3" class="step">
            <p class="step-instructions">📎 Upload supporting documents (optional)</p>
            <div class="grid">
                <!-- IMPORTANT: names must match Applicant properties -->
                <div><label>Certificates</label><input type="file" name="CertificatesFiles" multiple /></div>
                <div><label>Additional Documents</label><input type="file" name="AdditionalDocumentsFiles" multiple /></div>
            </div>
            <div class="button-group">
                <button type="button" class="btn-back" onclick="goToStep(2)">Back</button>
                <button type="submit" class="btn-submit">Submit Application</button>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        function goToStep(step) {
            document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
            document.getElementById('step' + step).classList.add('active');

            document.querySelectorAll('.progress-dots span').forEach((dot, i) => {
                dot.classList.toggle('active', i + 1 === step);
            });

            const hidden = document.getElementById('CurrentStep');
            if (hidden) hidden.value = step;
        }

        // On reload (especially when validation fails), return to the last step
        document.addEventListener('DOMContentLoaded', () => {
            const hidden = document.getElementById('CurrentStep');
            const step = hidden && hidden.value ? parseInt(hidden.value) : 1;
            goToStep(isNaN(step) ? 1 : step);
        });
    </script>

    @await Html.PartialAsync("_ValidationScriptsPartial")
}
